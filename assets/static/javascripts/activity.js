"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):jQuery)}(function(t){function i(o,e){this.$element=t(o),this.options=t.extend({},i.DEFAULTS,t.isPlainObject(e)&&e),this.init()}var o=window.Mustache,e="qor.activity",n="click."+e,a=".qor-activity__lists";return i.prototype={constructor:i,init:function(){this.bind(),this.initTabs()},bind:function(){this.$element.on(n,t.proxy(this.click,this)).on("submit.qor.activity","form",t.proxy(this.submit,this)),t(document).on(n,".qor-tab__activity",t.proxy(this.tabClick,this))},unbind:function(){this.$element.off(n).off("submit.qor.activity","form"),t(document).off(n,".qor-tab__activity")},submit:function(i){var o,e=t(i.target),n=this,r=t("#scroll-tab-activity").data().noteTitle;return i.preventDefault(),o=e.serialize(),t.ajax(e.prop("action"),{method:e.prop("method"),data:o,dataType:"json",headers:{Accept:"application/json; charset=utf-8"}}).done(function(i){i.errors||(i.NoteTitle=r,e.is(".qor-activity__edit-note_form")&&(n.hideEditForm(e),e.find(".qor-activity__list-note").html(i.Note)),e.is(".qor-activity__new-note_form")&&(t(a).prepend(n.renderActivityList(i)),n.clearForm()))}),!1},renderActivityList:function(t){return o.render(i.ACTIVITY_LIST_TEMPLATE,t)},clearForm:function(){t('textarea[data-toggle="qor.redactor"]').redactor("code.set",""),t(".qor-activity__new-note_form").find('[name="QorResource.Content"],[name="QorResource.Note"]').val("")},click:function(i){var o=t(i.target);if(i.stopPropagation(),o.is(".qor-activity__edit-button")){var e=o.closest(".qor-activity__list");this.showEditForm(e)}},tabClick:function(){var i=this,o=t(a).find(".qor-activity__list").length,e=t("#scroll-tab-activity").data().noteTitle;if(!o){var n=t(".qor-tab__activity").data("resource-url");o?t(a).find(".mdl-spinner").remove():t.ajax({url:n,method:"GET",dataType:"json",headers:{Accept:"application/json; charset=utf-8"},success:function(o){if(o.length){t(a).html("");for(var n=o.length-1;n>=0;n--)o[n].NoteTitle=e,t(a).append(i.renderActivityList(o[n]))}t(a).find(".mdl-spinner").remove()}})}},showEditForm:function(t){t.find(".qor-activity__list-note,.qor-activity__edit-button").removeClass("show").addClass("hide"),t.find(".qor-activity__edit-feilds,.qor-activity__edit-save-button").removeClass("hide").addClass("show")},hideEditForm:function(t){t.find(".qor-activity__list-note,.qor-activity__edit-button").removeClass("hide").addClass("show"),t.find(".qor-activity__edit-feilds,.qor-activity__edit-save-button").removeClass("show").addClass("hide")},initTabs:function(){t(".qor-slideout.is-shown").get(0)||(t(".qor-page__body").append(i.CONTENT_HTML),t(".qor-form-container").appendTo(t("#scroll-tab-form")),t("#scroll-tab-activity").appendTo(".mdl-layout__content"),t(".qor-page__header .qor-tab-bar--activity-header").prependTo(".mdl-layout.qor-sliderout__activity-container"),t(".qor-page > .qor-page__header").hide(),t(".qor-page > .qor-page__header .qor-action-forms").prependTo("#scroll-tab-form"),t(".qor-layout .mdl-layout__content.has-header").removeClass("has-header"),t("#scroll-tab-activity").wrapInner('<div class="qor-form-container"></div>'))},destroy:function(){this.unbind(),this.$element.removeData(e)}},i.CONTENT_HTML='<div class="mdl-layout mdl-js-layout qor-sliderout__activity-container">\n            <main class="mdl-layout__content qor-slideout--activity-content">\n                <div class="mdl-layout__tab-panel is-active" id="scroll-tab-form"></div>\n            </main>\n        </div>',i.DEFAULTS={},i.ACTIVITY_LIST_TEMPLATE='<div class="qor-activity__list">\n            <form class="qor-activity__edit-note_form" action=[[ URL ]] method="POST">\n                <input type="hidden" name="QorResource.ID" value=[[ ID ]]>\n                <div class="qor-activity__list-title">\n                    <strong>[[ CreatorName ]]</strong> <span>[[ Action ]]</span>\n                </div>\n                <div class="qor-activity__list-date">\n                    [[ UpdatedAt ]]\n                </div>\n                <div class="qor-activity__list-content">[[ &Content ]]</div>\n                <div>\n                    <strong>[[ NoteTitle ]]</strong>\n                    <span class="qor-activity__list-note">[[ Note ]]</span>\n                    <a class="mdl-button mdl-js-button mdl-button--icon qor-activity__edit-button" href="#">\n                        <i class="material-icons md-18 qor-activity__edit-button">edit</i>\n                    </a>\n                    <div class="mdl-textfield mdl-js-textfield qor-activity__edit-feilds">\n                        <label class="mdl-textfield__label">[[ Note ]]</label>\n                        <input class="mdl-textfield__input" type="text" name="QorResource.Note" value="[[ Note ]]">\n                    </div>\n                    <button class="mdl-button mdl-js-button mdl-button--icon qor-activity__edit-save-button" type="submit"><i class="material-icons md-24">done</i></button>\n                </div>\n            </form>\n        </div>',i.plugin=function(o){return this.each(function(){var n,a=t(this),r=a.data(e);if(!r){if(/destroy/.test(o))return;a.data(e,r=new i(this,o))}"string"==typeof o&&t.isFunction(n=r[o])&&n.apply(r)})},t.fn.qorSliderAfterShow.qorActivityinit=function(){var o=t(".qor-slideout > .qor-slideout__body"),e=t(".qor-slideout .qor-tab-bar--activity-header");o.wrapInner(i.CONTENT_HTML),t(".qor-sliderout__activity-container").prepend(e),t(".qor-slideout--activity-content").append(t(".qor-slideout #scroll-tab-activity"))},t(function(){var o='[data-toggle="qor.activity"]';t(document).on("disable.qor.activity",function(e){i.plugin.call(t(o,e.target),"destroy")}).on("enable.qor.activity",function(e){i.plugin.call(t(o,e.target))}).triggerHandler("enable.qor.activity")}),i});